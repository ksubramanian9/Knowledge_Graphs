<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Graph Theory Knowledge Graph + Ollama</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">

<style>
  :root { --bg:#0f172a; --panel:#111827; --ink:#e5e7eb; --muted:#94a3b8; --warn:#f59e0b; }
  html, body { height:100%; margin:0; background:var(--bg); color:var(--ink); font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu; }
  .wrap { display:grid; grid-template-columns: 1fr 360px; height:100%; }
  header { grid-column:1 / -1; padding:10px 14px; border-bottom:1px solid #1f2937; display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  header .title { font-weight:700; letter-spacing:.2px; margin-right:10px; }
  header input[type="text"] { background:#0b1220; border:1px solid #1f2937; color:var(--ink); padding:8px 10px; border-radius:8px; width:240px; }
  header select, header button, header label, header details { background:#0b1220; border:1px solid #1f2937; color:var(--ink); padding:8px 10px; border-radius:8px; }
  header button { cursor:pointer; }
  header .chip { display:inline-flex; gap:6px; align-items:center; padding:6px 8px; border-radius:999px; border:1px solid #1f2937; }
  #graph { background: radial-gradient(1200px 500px at 50% -200px, #0b1220, #0a1020 60%, #090e1a); width:100%; height:calc(100vh - 60px); }
  #panel { background:var(--panel); border-left:1px solid #1f2937; padding:12px; overflow:auto; }
  #panel h2 { font-size:16px; margin:10px 0 8px; }
  #answer.md { line-height:1.55; }
  #answer.md h1,#answer.md h2,#answer.md h3{ margin:.6em 0 .4em; }
  #answer.md h1{ font-size:1.35rem } #answer.md h2{ font-size:1.2rem } #answer.md h3{ font-size:1.05rem }
  #answer.md p{ margin:.5em 0; }
  #answer.md ul,#answer.md ol{ padding-left:1.2em; margin:.4em 0; }
  #answer.md li{ margin:.2em 0; }
  #answer.md code{ background:#0b1220; padding:.15em .35em; border:1px solid #1f2937; border-radius:4px; font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; }
  #answer.md pre{ background:#0b1220; border:1px solid #1f2937; padding:10px; border-radius:8px; overflow:auto; position:relative; }
  #answer.md pre code{ border:none; background:transparent; padding:0; display:block; }
  #answer.md blockquote{ border-left:3px solid #374151; margin:.6em 0; padding:.1em .8em; color:#cbd5e1; }
  #answer.md table{ width:100%; border-collapse:collapse; margin:.6em 0; }
  #answer.md th,#answer.md td{ border:1px solid #1f2937; padding:6px 8px; }
  .copy-btn {
    position:absolute; top:6px; right:6px; font-size:12px; padding:2px 6px;
    border:1px solid #334155; background:#0b1220; color:#e5e7eb; border-radius:6px; cursor:pointer;
  }
  .small { color:var(--muted); font-size:12px; }
  .kv { display:grid; grid-template-columns: 92px 1fr; gap:6px; }
  .legend { display:flex; gap:6px; flex-wrap:wrap; }
  .legend span { display:flex; align-items:center; gap:6px; padding:4px 8px; border:1px solid #1f2937; border-radius:999px; }
  .legend b { display:inline-block; width:10px; height:10px; border-radius:2px; }
  .warn { color:var(--warn); }
  .ok { color:#34d399; }
</style>
</head>
<body>
  <header>
    <div class="title">Graph Theory KG</div>
    <select id="selGraph" class="chip"></select>
    <input id="fileGraphs" type="file" multiple accept="application/json" style="display:none" />
    <label for="fileGraphs" class="chip">Upload JSON</label>
    <input id="search" type="text" placeholder="Search node…" />
    <button id="btnFocus">Focus</button>
    <select id="selCat">
      <option value="ALL">All categories</option>
    </select>
    <label class="chip"><input type="checkbox" id="chkLabels" /> Edge labels</label>
    <label class="chip"><input type="checkbox" id="chkDirected" /> Directed paths</label>
    <button id="btnPath">Shortest Path</button>
    <button id="btnReset">Reset</button>
    <details>
      <summary>Data</summary>
      <button id="btnDownload" style="margin-top:6px">Download JSON</button>
      <button id="btnSelfTest" style="margin-top:6px">Self-Test</button>
      <button id="btnDownloadMD" style="margin-top:6px">Download AI Markdown</button>
    </details>
    <span id="status" class="small"></span>
  </header>

  <div class="wrap">
    <svg id="graph"></svg>
    <aside id="panel">
      <h2>Node</h2>
      <div id="nodeMeta" class="kv small"></div>
      <h2>AI (Ollama: llama3.2)</h2>
      <div id="answer" class="small md">Click a node to fetch an explanation…</div>
      <div class="small" style="margin-top:8px;">Proxy served by app: <code>/ask</code></div>
      <h2>Legend</h2>
      <div id="legend" class="legend"></div>
    </aside>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <script type="module" src="main.js"></script>
</body>
</html>
